# 🛡️ Malware Analysis - CyberDefenders Lab's

## 🧪 Lab Overview

- **Lab Name**: Oski  
- **Category**: Threat Intelligence  
- **Tactics Covered**:
  - Initial Access
  - Execution
  - Defense Evasion
  - Credential Access
  - Command and Control
  - Exfiltration  
- **Tools Used**:
  - [VirusTotal](https://www.virustotal.com/)
  - [ANY.RUN](https://any.run/)

- **Scenario**: The accountant at the company received an email titled "Urgent New Order" from a client late in the afternoon. When he attempted to access the attached invoice, he discovered it contained false order information. Subsequently, the SIEM solution generated an alert regarding downloading a potentially malicious file. Upon initial investigation, it was found that the PPT file might be responsible for this download. Could you please conduct a detailed examination of this file?
---

## 🧩 Questions & Solutions

### Q1 — **Malware Creation Timestamp**

> 🕒 **Question**: Determining the creation time of the malware can provide insights into its origin. What was the time of malware creation?  

> 📅 **Answer**: `2022-09-28 17:40`

📌 _This timestamp was extracted from VirusTotal; go to the file’s Details tab and examine the History section, which reveal the creation time._
     
    
---![Capture VirusTotal, Details, History](VirusTotal.png)


### Q2 — **C2 Server Identification**

> 🌐 **Question**: Identifying the command and control (C2) server that the malware communicates with can help trace back to the attacker. Which C2 server does the malware in the PPT file communicate with?  

> 📡 **Answer**: `http://171.22.28.221/5c06c05b7b34e8e6.php`

📌 _Check the file's network activity for outbound connections to URLs or IP addresses, as these may indicate communication with a command-and-control (C2) server. In VirusTotal, navigate to the Relations section and look for Contacted URLs._


---![Capture VirusTotal, Relations, Contacted URLs.](VirusTotalPHP.png)


### Q3 — **First Library Loaded**

> 📚 **Question**: Identifying the initial actions of the malware post-infection can provide insights into its primary objectives. What is the first library that the malware requests post-infection?  

> 📂 **Answer**: `sqlite3.dll`

📌 _Malware often loads specific libraries upon infection to perform malicious activities. In VirusTotal, go to the Behavior section ad then look for Files Dropped, you should find the associated DLL file._

---![Capture VirusTotal, Behavior, Files Dropped](VirusTotalSQL.png)


### Q4 — **RC4 Key Detection**

> 🔑 **Question**: By examining the provided Any.run report, what RC4 key is used by the malware to decrypt its base64-encoded string?  

> 🧬 **Answer**: `5329514621441247975720749009`

📌 _The RC4 key used for encryption or decryption may be embedded in the malware configuration; dynamic analysis tools can sometimes reveal this key directly. We can check the Malware Configuration section for encryption keys, the RC4 key is often listed there if it’s part of the malware’s config._


---![Capture ANY.RUN, Malware Configuration](ANY.RUNMC.png)


### Q5 — **MITRE Technique - Credential Access**

> 🧠 **Question**: By examining the MITRE ATT&CK techniques displayed in the Any.run sandbox report, identify the main MITRE technique (not sub-techniques) the malware uses to steal the user’s password.  

> 🛠️ **Answer**: `T1555`

📌 _Mapped by analyzing MITRE ATT&CK techniques flagged automatically in ANY.RUN’s behavior report._

---![Capture ANY.RUN, MITRE ATTACK techniques](ANYRUN1555.png)

---![Capture MITRE ATTACK](ANYRUNMT.png)


### Q6 — **Targeted Directory for DLL Deletion**

> 🗂️ **Question**: By examining the child processes displayed in the Any.run sandbox report, which directory does the malware target for the deletion of all DLL files?

> 📁 **Answer**: `C:\ProgramData`

📌 _Malware often deletes files to cover its tracks. We can check in the command-line execution captured in the sandbox timeline._


---![Capture ANY.RUN, MITRE ATTACK techniques](ANYRUNPrgFil.png)


### Q7 — **Self-Deletion Timing**

> ⏳ **Question**: After exfiltrating the user’s data, how many seconds does it take for the malware to self-delete?  

> 🧨 **Answer**: `5 seconds`

📌 _Measured using the timeline of process execution in ANY.RUN sandbox._

![ANY.RUN timeout.exe](ANYRUNT5.png)


## 🧰 Tools Used

- **VirusTotal** — Static analysis and community-based detection
- **ANY.RUN** — Dynamic analysis, process behavior, and MITRE mapping

---

## 🧾 Conclusion

This write-up documents a full malware analysis workflow using public sandbox environments and common threat intel tools. It highlights how to extract indicators, interpret malware behavior, and map findings to frameworks like MITRE ATT&CK — skills essential for an entry-level SOC analyst.

---

## 📁 Author

**Juan Capitán** – Cybersecurity Analyst  


